---
import { getTestimoniosData } from "../actions/cms.actions";
import { Swiper } from "swiper/bundle";

let testimoniosData = null;
let error = null;

try {
    const result = await Astro.callAction(getTestimoniosData, {});
    if (result.error) {
        console.error("Error fetching testimonios data:", result.error);
        error = result.error;
    } else if (result.data) {
        testimoniosData = result.data;
    }

    console.log(testimoniosData);
} catch (e) {
    console.error("Exception fetching testimonios data:", e);
    error = e;
}

const defaultData = {
    titulo: "TESTIMONIOS",
    subtitulo: "Historias que Inspiran",
    descripcion: "Descubre cómo nuestro trabajo ha transformado vidas, uniendo familias y creando lazos inquebrantables",
    testimonios: [
        {
            nombre: "Ana María Rodríguez",
            rol: "Madre adoptiva de Luna",
            imagen: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80",
            texto: "Adoptar a Luna fue la mejor decisión que pudimos tomar como familia. El proceso fue transparente y el equipo nos apoyó en todo momento. Ahora no podemos imaginar nuestra vida sin ella.",
        },
        {
            nombre: "Carlos Mendoza",
            rol: "Voluntario y padrino",
            imagen: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e",
            texto: "Ser voluntario en la fundación me ha permitido ver de primera mano el amor y dedicación que ponen en cada animal. Es increíble ver cómo transforman vidas todos los días.",
        },
        {
            nombre: "Isabella Martínez",
            rol: "Adoptante de Max",
            imagen: "https://images.unsplash.com/photo-1494790108377-be9c29b29330",
            texto: "La fundación hace un trabajo excepcional. No solo encontré a mi compañero perfecto, sino que también recibí todo el asesoramiento necesario para darle el mejor hogar posible.",
        },
        {
            nombre: "Javier Pérez",
            rol: "Padre adoptivo de Milo",
            imagen: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e",
            texto: "Adoptar a Milo fue una experiencia maravillosa. El equipo de la fundación nos ayudó a encontrar al gato perfecto para nuestra familia. ¡Gracias por todo!",
        },
    ]
};

const finalData = (testimoniosData && testimoniosData.success && testimoniosData.data) ? testimoniosData.data : defaultData;
---

<section class="py-24 bg-amber-50">
    <div class="max-w-6xl mx-auto px-4">
        <div class="text-center mb-16">
            <span class="text-amber-600 font-medium mb-4 block">
                {finalData.titulo}
            </span>
            <h2 class="text-4xl md:text-5xl font-bold text-amber-900 mb-6">
                {finalData.subtitulo}
            </h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                {finalData.descripcion}
            </p>
        </div>

        <!-- Swiper container -->
        <div class="swiper testimonials-swiper">
            <div class="swiper-wrapper pb-12">
                {
                    finalData.testimonios.map((testimonial) => (
                        <div class="swiper-slide">
                            <div class="bg-white rounded-xl p-8 shadow-md hover:shadow-xl transition-all duration-300 mx-4">
                                <div class="flex items-center gap-4 mb-6">
                                    <img
                                        src={testimonial.imagen}
                                        alt={testimonial.nombre}
                                        class="w-16 h-16 rounded-full object-cover"
                                    />
                                    <div>
                                        <h3 class="text-xl font-semibold text-amber-900">
                                            {testimonial.nombre}
                                        </h3>
                                        <p class="text-gray-600">
                                            {testimonial.rol}
                                        </p>
                                    </div>
                                </div>
                                <div class="relative">
                                    <p class="text-gray-600 leading-relaxed">
                                        {testimonial.texto}
                                    </p>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
            <!-- Pagination -->
            <div class="swiper-pagination"></div>
        </div>
    </div>
</section>

<style>
    @import "swiper/css";
    @import "swiper/css/pagination";

    .testimonials-swiper {
        padding-bottom: 3rem;
    }

    :root {
        --swiper-theme-color: #d97706;
    }
</style>

<script>
    import Swiper from "swiper";
    import { Pagination, Autoplay } from "swiper/modules";

    new Swiper(".testimonials-swiper", {
        modules: [Pagination, Autoplay],
        slidesPerView: 1,
        spaceBetween: 32,
        autoplay: {
            delay: 5000,
        },
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        breakpoints: {
            640: {
                slidesPerView: 2,
            },
            1024: {
                slidesPerView: 3,
            },
        },
    });
</script>
