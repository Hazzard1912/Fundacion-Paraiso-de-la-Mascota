---
import { getHistoriaData } from "../actions/cms.actions";

let historiaData = null;
let error = null;

try {
    const result = await Astro.callAction(getHistoriaData, {});
    if (result.error) {
        console.error("Error fetching historia data:", result.error);
        error = result.error;
    } else if (result.data) {
        historiaData = result.data;
    }
} catch (e) {
    console.error("Exception fetching historia data:", e);
    error = e;
}

const defaultData = {
    titulo: "Nuestra Historia",
    introduccion: "La Fundación Paraíso de la Mascota se creó en el año 2003 como una entidad sin ánimo de lucro, con la intención de:",
    objetivos: [
        "Crear conciencia social en la comunidad sobre la tenencia responsable de mascotas.",
        "Evitar la reproducción indiscriminada de animales callejeros por medio de campañas de esterilización en Cali y sus alrededores.",
        "Proteger y defender a los animales maltratados y/o abandonados, brindándoles en nuestro centro de adopción, un hogar de paso."
    ],
    frase: "¡Somos la voz de los que no tienen voz!",
    imagenRefugio: "/images/shelter-dogs.jpg",
    centroTitulo: "Nuestro Centro de Adopción",
    centroDescripcion: "Esta labor la llevamos a cabo desde nuestro centro de adopción localizado en Cali, Colombia; donde tenemos a 300 animalitos entre perros y gatos, en proceso de ser adoptados. Todo esto es logrado con el esfuerzo y dedicación de aquellas personas que contribuyen voluntariamente, movidas por el amor incondicional hacia estos seres que sólo esperan ser tratados dignamente y tener la oportunidad de demostrar su eterna gratitud.",
    imagenCentro: "/images/kid-dog.jpg",
    fundadoraTitulo: "Nuestra Fundadora",
    fundadoraDescripcion: "El centro de adopción viene funcionando desde Noviembre de 1999, por iniciativa de nuestra Fundadora y actual Presidente, señora Ofelia Villegas, quien después de su jubilación, empezó a rescatar animalitos de la calle, llevándolos a su casa. Esta obra fue creciendo a través de los años, hasta alquilar un lugar con mayor espacio en Diciembre de 2001. Sin los recursos económicos suficientes, logró lo que siempre han querido hacer los protectores de animales: tener un Centro de Adopción sin ningún apoyo del estado, solo con el apoyo de las personas que aman y se preocupan por el bienestar animal. A las que agradecemos inmensamente su apoyo.",
    imagenFundadora: "/images/founder.jpg"
};

const finalData = (historiaData && historiaData.success && historiaData.data) ? historiaData.data : defaultData;
---

<section class="py-16 bg-amber-50/50" id="historia">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Section Header -->
        <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-amber-800 mb-4">
                {finalData.titulo}
            </h2>
            <div class="w-24 h-1 bg-amber-500 mx-auto"></div>
        </div>

        <!-- Foundation Introduction -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-16">
            <div class="grid md:grid-cols-2 items-center">
                <div class="p-8 md:p-12">
                    <h3 class="text-3xl font-bold text-amber-700 mb-6">
                        Sobre Nosotros
                    </h3>
                    <p class="text-gray-700 mb-4">
                        {finalData.introduccion}
                    </p>

                    <ul class="space-y-3 mb-6">
                        {finalData.objetivos.map((objetivo) => (
                            <li class="flex items-start">
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6 text-amber-600 mr-2 flex-shrink-0 mt-0.5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M5 13l4 4L19 7"></path>
                                </svg>
                                <span>{objetivo}</span>
                            </li>
                        ))}
                    </ul>
                    <p class="italic text-amber-700 font-medium text-center text-lg mt-8">
                        {finalData.frase}
                    </p>
                </div>
                <div class="bg-amber-100 h-full">
                    <img
                        src={finalData.imagenRefugio}
                        alt="Perros en el refugio"
                        class="w-full h-full object-cover"
                    />
                </div>
            </div>
        </div>

        <!-- Current Status -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-16">
            <div class="grid md:grid-cols-5">
                <div class="p-8 md:col-span-3">
                    <h3 class="text-2xl font-bold text-amber-800 mb-6">
                        {finalData.centroTitulo}
                    </h3>
                    <p class="text-gray-700 mb-4">
                        {finalData.centroDescripcion}
                    </p>
                    <div class="flex justify-center md:justify-start">
                        <a
                            href="/mascotas"
                            class="px-6 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors inline-flex items-center"
                        >
                            <span>Conoce a nuestros peludos</span>
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-5 w-5 ml-2"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                                    clip-rule="evenodd"></path>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="md:col-span-2 bg-amber-100">
                    <img
                        src={finalData.imagenCentro}
                        alt="Niña con perro"
                        class="w-full h-full object-cover"
                    />
                </div>
            </div>
        </div>

        <!-- Founder Story -->
        <div class="bg-gradient-to-r from-amber-700 to-amber-500 rounded-xl shadow-lg overflow-hidden text-white">
            <div class="grid md:grid-cols-2 items-center">
                <div class="p-8 md:order-2">
                    <h3 class="text-2xl font-bold mb-6">{finalData.fundadoraTitulo}</h3>
                    <p class="mb-4">
                        {finalData.fundadoraDescripcion}
                    </p>
                </div>
                <div class="h-full md:order-1">
                    <img
                        src={finalData.imagenFundadora}
                        alt="Ofelia Villegas - Fundadora"
                        class="w-full h-full object-cover"
                    />
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    section > div > div {
        animation: fadeInUp 0.6s ease-out forwards;
        animation-delay: calc(var(--animation-order, 0) * 0.1s);
        opacity: 0;
    }

    @media (prefers-reduced-motion) {
        section > div > div {
            animation: none;
            opacity: 1;
        }
    }
</style>
