---
import { getFAQData } from "../actions/cms.actions";

let faqData = null;
let error = null;

try {
    const result = await Astro.callAction(getFAQData, {});
    if (result.error) {
        console.error("Error fetching FAQ data:", result.error);
        error = result.error;
    } else if (result.data) {
        faqData = result.data;
    }
} catch (e) {
    console.error("Exception fetching FAQ data:", e);
    error = e;
}

const defaultData = {
    titulo: "Preguntas Frecuentes",
    preguntas: [
        {
            pregunta: "¿Cómo funciona el proceso de adopción?",
            respuesta: `<p> Nuestro proceso de adopción consta de varios pasos para asegurar que nuestras mascotas encuentren hogares adecuados:</p>
<ol class='list-decimal pl-5 mt-2 space-y-1'>
<li>Completar un formulario de solicitud en línea o en nuestro refugio</li>
<li>Entrevista personal con uno de nuestros voluntarios</li>
<li>Visita domiciliaria para verificar las condiciones del hogar</li>
<li>Aprobación de la solicitud y pago de la cuota de adopción</li>
<li>Firma del contrato y entrega de la mascota</li>
</ol>
<p class='mt-2'>Todo el proceso suele durar entre 1 y 2 semanas dependiendo de la disponibilidad.</p>`
        },
        {
            pregunta: "¿Qué requisitos necesito cumplir para adoptar una mascota?",
            respuesta: `<p>Los requisitos básicos para adoptar incluyen:</p>
<ul class='list-disc pl-5 mt-2 space-y-1'>
<li>Ser mayor de edad y presentar identificación válida</li>
<li>Contar con un domicilio estable y adecuado para la mascota</li>
<li>Autorización del propietario de la vivienda (en caso de alquiler)</li>
<li>Compromiso de esterilización (si la mascota aún no lo está)</li>
<li>Disponibilidad de tiempo y recursos para atender las necesidades de la mascota</li>
<li>Aceptar visitas de seguimiento posteriores a la adopción</li>
</ul>`
        },
        {
            pregunta: "¿Ofrecen apoyo después de la adopción?",
            respuesta: `<p>¡Absolutamente! Entendemos que la adaptación puede presentar desafíos, por eso ofrecemos:</p>
<ul class='list-disc pl-5 mt-2 space-y-1'>
<li>Asesoría veterinaria básica durante el primer mes</li>
<li>Seguimiento telefónico para resolver dudas sobre comportamiento</li>
<li>Descuentos en servicios veterinarios con nuestros aliados</li>
<li>Grupo de apoyo con otros adoptantes para compartir experiencias</li>
<li>Recursos educativos sobre cuidado, entrenamiento y salud animal</li>
</ul>
<p class='mt-2'>Nuestro compromiso es asegurar una transición exitosa tanto para la mascota como para la familia adoptante.</p>`
        }
    ]
};
console.log("FAQ", faqData?.data);
const finalData = (faqData && faqData.success && faqData.data) ? faqData.data : defaultData;
---

<section class="bg-gray-50 py-16">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-primary-600">
            {finalData.titulo}
        </h2>

        <div class="max-w-3xl mx-auto space-y-6">
            {finalData.preguntas.map((item, idx) => (
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <button
                        class="faq-toggle w-full py-4 px-6 text-left font-semibold text-gray-800 flex justify-between items-center"
                        id={`faq-toggle-${idx}`}
                        type="button"
                    >
                        <span>{item.pregunta}</span>
                        <svg
                            class="w-5 h-5 transform transition-transform duration-200"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div class="faq-content hidden px-6 pb-4 text-gray-600" id={`faq-content-${idx}`}
                        set:html={item.respuesta}>
                    </div>
                </div>
            ))}
        </div>
    </div>
</section>

<script>
    document.addEventListener("astro:page-load", () => {
        const toggles = document.querySelectorAll(".faq-toggle");

        toggles.forEach((toggle) => {
            toggle.addEventListener("click", () => {
                const content = toggle.nextElementSibling;
                const icon = toggle.querySelector("svg");

                // Toggle content visibility
                content.classList.toggle("hidden");

                // Rotate icon when open
                if (content.classList.contains("hidden")) {
                    icon.classList.remove("rotate-180");
                } else {
                    icon.classList.add("rotate-180");
                }
            });
        });
    });
</script>
