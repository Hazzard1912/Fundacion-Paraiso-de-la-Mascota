---
import { actions } from "astro:actions";

const { data, error } = await Astro.callAction(actions.getNoticiasData, {});
const noticias = Array.isArray(data) ? data : Array.isArray(data?.data) ? data.data : [];
const ultimaNoticia = noticias.length > 0 ? noticias.sort((a, b) => new Date(b.fecha).getTime() - new Date(a.fecha).getTime())[0] : null;

function formatDate(dateString: string) {
  const date = new Date(dateString);
  return date.toLocaleDateString("es-CO", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

{ultimaNoticia && (
  <section class="relative bg-gradient-to-br from-amber-100 via-white to-amber-50 py-20 my-24 shadow-2xl rounded-3xl overflow-hidden">
    <div class="absolute inset-0 pointer-events-none">
      <div class="w-96 h-96 bg-amber-200 opacity-30 rounded-full blur-3xl absolute -top-32 -left-32"></div>
      <div class="w-80 h-80 bg-amber-400 opacity-20 rounded-full blur-2xl absolute -bottom-24 -right-24"></div>
    </div>
    <div class="relative max-w-5xl mx-auto px-6 flex flex-col md:flex-row gap-10 items-center z-10">
      <div class="flex-1 w-full">
        {ultimaNoticia.imagen?.url ? (
          <div class="overflow-hidden rounded-3xl shadow-2xl border-4 border-amber-200">
            <img
              src={ultimaNoticia.imagen.url}
              alt={ultimaNoticia.imagen.alternativeText || ultimaNoticia.titulo}
              class="w-full h-80 object-cover scale-105 hover:scale-110 transition-transform duration-500"
            />
          </div>
        ) : (
          <div class="w-full h-80 flex items-center justify-center text-amber-400 text-7xl bg-amber-50 rounded-3xl border-4 border-amber-200 shadow-2xl">ðŸ“°</div>
        )}
      </div>
      <div class="flex-1 w-full flex flex-col justify-center items-start">
        <span class="uppercase tracking-widest text-amber-700 font-bold text-xs mb-2 bg-amber-100 px-3 py-1 rounded-full shadow">Ãšltima noticia</span>
        <h2 class="text-4xl md:text-5xl font-extrabold text-amber-900 mb-4 leading-tight drop-shadow-lg">{ultimaNoticia.titulo}</h2>
        <div class="flex items-center gap-3 mb-4">
          <span class="text-amber-700 font-medium text-sm flex items-center gap-1">
            <svg class="w-4 h-4 text-amber-500" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            {formatDate(ultimaNoticia.fecha)}
          </span>
        </div>
        <p class="text-lg text-gray-700 mb-8 line-clamp-4">{ultimaNoticia.resumen}</p>
        <a
          href={`/noticias/${ultimaNoticia.slug}`}
          class="inline-block bg-amber-600 text-white px-8 py-3 rounded-xl font-bold text-lg shadow-lg hover:bg-amber-700 hover:scale-105 transition-all duration-300"
        >
          Leer noticia
        </a>
      </div>
    </div>
  </section>
)}