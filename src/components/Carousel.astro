---
import { getSlidesData } from "../actions/cms.actions";
import "swiper/css";
import "swiper/css/pagination";
import "swiper/css/navigation";

// Obtener los slides activos desde Strapi
interface Slide {
    id: number;
    imageUrl: string;
    alternativeText: string | null;
}

let slides: Slide[] = [];
let error = null;

try {
    const result = await Astro.callAction(getSlidesData, {});
    if (result.error) {
        console.error("Error fetching slides:", result.error);
        error = result.error;
    } else if (result.data && Array.isArray(result.data?.data)) {
        slides = result.data.data.filter((slide: any) => slide.imageUrl);
        console.log("Slides:", slides);
    } else {
        console.error("No data returned from getSlidesData");
        error = new Error("No data returned");
    }
} catch (e) {
    console.error("Exception fetching slides:", e);
    error = e;
}
---

{
    error ? (
        <div class="bg-red-100 text-red-700 p-4 rounded-lg mt-8 max-w-2xl mx-auto">
            Error cargando las imágenes del slider
        </div>
    ) : slides.length === 0 ? null : (
        <div class="mt-12 max-w-4xl mx-auto p-4 bg-white rounded-xl shadow-lg">
            <div class="swiper">
                <div class="swiper-wrapper">
                    {slides.map((slide: any, index: number) => (
                        <div class="swiper-slide flex justify-center items-center">
                            <img
                                src={slide.imageUrl}
                                alt={`Campaña ${index + 1}`}
                                class="w-full h-auto md:h-[400px] object-cover rounded-lg"
                            />
                        </div>
                    ))}
                </div>
                {slides.length > 1 && (
                    <>
                        <div class="swiper-pagination" />
                        <div class="swiper-button-prev" />
                        <div class="swiper-button-next" />
                    </>
                )}
            </div>
        </div>
    )
}

<script>
    import Swiper from "swiper/bundle";
    if (document.querySelector(".swiper")) {
        new Swiper(".swiper", {
            effect: "slide",
            loop: true,
            autoplay: { delay: 5000, disableOnInteraction: false },
            pagination: { el: ".swiper-pagination", clickable: true },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            slidesPerView: 1,
            spaceBetween: 20,
        });
    }
</script>

<style>
    /* Mantener solo los estilos de diseño general */
    .swiper {
        width: 100%;
        height: 100%;
    }
    .swiper-slide img {
        display: block;
        margin: 0 auto;
        max-height: 400px;
        object-fit: cover;
        border-radius: 0.75rem;
    }
</style>
